<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jogo da Memória - Hora de Aventura</title>
    <link rel="stylesheet" href="styles/styles.css" />
    <audio id="match-sound" src="sounds/match.wav" preload="auto"></audio>
    <audio id="game-over-sound" src="sounds/game-over.wav" preload="auto"></audio>
    <audio id="victory-sound" src="sounds/victory.wav" preload="auto"></audio>
    <audio id="background-music" src="sounds/background-music.mp3" preload="auto" loop></audio>

    <!--sons dos personagens-->
    <audio id="bell-fin" src="sounds/bells/bell1.wav" preload="auto"></audio>
<audio id="bell-jake" src="sounds/bells/bell2.wav" preload="auto"></audio>
<audio id="bell-jujuba" src="sounds/bells/bell3.wav" preload="auto"></audio>
  </head>
  <body>
    <header class="header">
      <ul class="nav">
        <li><a href="index.html">Início</a></li>
        <li><a href="#" onclick="showAccessibilitySettings()">Configurações de Acessibilidade</a></li>
      </ul>
    </header>
    <div id="menu">
      <img src="src/botaoiniciarjogo.png" alt="Iniciar Jogo" onclick="showModeSelection()" style="cursor: pointer; width: 200px; height: auto;">
    </div>
    <div class="game-container" id="game-container">
      <div id="timer">Tempo: 0s</div>
      <div id="difficulty-selection">
        <img src="src/facil.png" alt="Fácil" onclick="startGame('practice', 3, 4)">
        <img src="src/medio.png" alt="Médio" onclick="startGame('practice', 4, 5)">
        <img src="src/dificil.png" alt="Difícil" onclick="startGame('practice', 5, 6)">
      </div>
      <div id="game-board"></div>
    </div>
    <script>
      let gameContainer = document.getElementById("game-container");
      let gameBoard = document.getElementById("game-board");
      let gameTitle = document.getElementById("game-title");
      let cardImages = [
        "src/jujuba.jpg",
        "src/jake.jpg",
        "src/lady iris.jpg",
        "src/rei da noitosfera.jpg",
        "src/marcelinne.jpg",
        "src/Ricardio.jpg",
        "src/gunther.jpg",
        "src/shoko.jpg",
        "src/simon.webp",
        "src/princesafogo.jpg",
        "src/fin.jpg",
        "src/canelinha.jpg",
        "src/Betty Grof.jpg",
        // "src/111.jpg",
        // "src/121.jpg",
        // "src/122.jpg",
        // "src/1223.png",
        // "src/234.png",
      ];
      let cardArray = [];
      let flippedCards = [];
      let matchedCards = [];
      let moves = 0;
      let maxMoves = 0;
      let timer;
      let startTime;
      function showModeSelection() {
        document.getElementById("menu").style.display = "none";
        gameContainer.style.display = "block";
      }
      function startGame(mode, rows, cols) {
        gameBoard.innerHTML = "";
        cardArray = shuffleCards(createCardArray(rows, cols));
        matchedCards = [];
        flippedCards = [];
        moves = 0;

        maxMoves = mode === "time" ? 60 : Infinity;

        gameBoard.style.gridTemplateColumns = `repeat(${cols}, 100px)`;
        gameBoard.style.gridTemplateRows = `repeat(${rows}, 100px)`;

        for (let i = 0; i < rows * cols; i++) {
          let card = document.createElement("div");
          card.classList.add("card");
          card.dataset.image = cardArray[i];
          let img = document.createElement("img");
          img.src = cardArray[i];
          card.appendChild(img);
          card.addEventListener("click", () => flipCard(card));
          gameBoard.appendChild(card);
        }
        startTime = new Date().getTime();
        timer = setInterval(updateTimer, 1000);
      }
      function createCardArray(rows, cols) {
        let numCards = rows * cols;
        let cards = [];
        for (let i = 0; i < numCards / 2; i++) {
          let img = cardImages[i % cardImages.length];
          cards.push(img, img);
        }
        return cards;
      }
      function shuffleCards(cards) {
        for (let i = cards.length - 1; i > 0; i--) {
          let j = Math.floor(Math.random() * (i + 1));
          [cards[i], cards[j]] = [cards[j], cards[i]];
        }
        return cards;
      }
      function flipCard(card) {
        if (
          flippedCards.length < 2 &&
          !card.classList.contains("flipped") &&
          !matchedCards.includes(card)
        ) {
          card.classList.add("flipped", "flip-animation");
          flippedCards.push(card);
          if (flippedCards.length === 2) {
            setTimeout(() => checkMatch(), 500);
          }
        }
      }

      if (soundEnabled) {
        const cardName = card.dataset.image.split("/").pop().split(".")[0];
        const sound = new Audio(`sounds/bells/${cardName}.wav`);
        sound.play();
      }

      if(flippedCards.length === 2) {
        setTimeout(() => checkMatch(), 500);
      }

      function checkMatch() {
        let [card1, card2] = flippedCards;
        if (card1.dataset.image === card2.dataset.image) {
          card1.classList.add("matched");
          card2.classList.add("matched");
          matchedCards.push(card1, card2);
          if (
            matchedCards.length === document.querySelectorAll(".card").length
          ) {
            endGame();
          }
        } else {
          card1.classList.remove("flipped");
          card2.classList.remove("flipped");
        }
        flippedCards = [];
        moves++;
      }
      function updateTimer() {
        let elapsedTime = Math.floor((new Date().getTime() - startTime) / 1000);
        if (elapsedTime >= maxMoves) {
          endGame();
        }
      }
      function endGame() {
        clearInterval(timer);
        alert(`Game Over!\nMoves: ${moves}`);
        document.getElementById("menu").style.display = "block";
        gameContainer.style.display = "none";
      }

       // Função para mostrar as configurações de acessibilidade
      function showAccessibilitySettings() {
        const enableBraille = confirm("Deseja habilitar o Braille Display?");
        brailleDisplayEnabled = enableBraille;

        const enableSound = confirm("Deseja habilitar os sons das cartas?");
        soundEnabled = enableSound;

        alert(`Configurações atualizadas:\nBraille Display: ${brailleDisplayEnabled ? "Habilitado" : "Desabilitado"}\nSons: ${soundEnabled ? "Habilitados" : "Desabilitados"}`);
      }

      const SoundSystem = {
        sounds: {
          match: document.getElementById("match-sound"),
          gameOver: document.getElementById("game-over-sound"),
          victory: document.getElementById("victory-sound"),
          backgroundMusic: document.getElementById("background-music"),
          bells: {
            fin: document.getElementById("bell-fin"),
            jake: document.getElementById("bell-jake"),
            jujuba: document.getElementById("bell-jujuba"),
            marceline: document.getElementById("bell-marceline"),
            princesafogo: document.getElementById("bell-princesafogo"),
            caroço: document.getElementById("bell-caroço"),
            rei: document.getElementById("bell-rei"),
            ricardio: document.getElementById("bell-ricardio"),
            menta: document.getElementById("bell-menta"),
          }
        },

        //como configurar volume dos sons
        volume: {
          music: 0.5,
          effects: 1.0
        },

        // tocar efeitos sonoros
        playEffect(name) {
          if(!soundEnabled) return;
          try {
            const sound = this.sounds[name];
            if(sound) {
              sound.volume = this.volume.effects;
              sound.currentTime = 0;
              sound.play();
            }
          } catch(e) {
            console.error(`Erro ao tocar efeito sonoro: ${name}`, e);
          }
        },

        // tocar sino especifico do personagem
        playBell(character) {
          if(!soundEnabled) return;
          try {
            const bell = this.sounds.bells[character];
            if(bell) {
              bell.volume = this.volume.effects;
              bell.currentTime = 0;
              bell.play();
            }
          } catch(e) {
            console.error(`Erro ao tocar sino do personagem: ${character}`, e);
          }
        },

        // controlar musica de fundo
        playBackgroundMusic() {
        try {
          this.sounds.backgroundMusic.volume = this.volume.music;
          this.sounds.backgroundMusic.loop = true;
          this.sounds.backgroundMusic.play();
        } catch (e) {
          console.error("Error playing background music:", e);
        }
      },
  
        stopBackgroundMusic() {
        this.sounds.backgroundMusic.pause();
        this.sounds.backgroundMusic.currentTime = 0;
      }
    };
// Inicialize a música de fundo quando o jogo começar
    SoundSystem.playBackgroundMusic();
      
    </script>
  </body>
</html>